<script lang="ts">
  import { page } from "$app/stores";
  import { tw } from "@/lib/tailwind";
  import { quintOut } from "svelte/easing";
  import { crossfade } from "svelte/transition";

  const BUBBLE = "navbar-bubble";
  const ROUTES = [
    { name: "Discover", path: "/app" },
    { name: "Feeds", path: "/app/feed" },
    { name: "Account", path: "/app/account" },
  ];

  const [send, receive] = crossfade({
    fallback: (node) => {
      const style = getComputedStyle(node);
      const transform = style.transform === "none" ? "" : style.transform;

      return {
        duration: 600,
        easing: quintOut,
        css: (t) => `
					transform: ${transform} scale(${t});
					opacity: ${t}
				`,
      };
    },
  });
</script>

<nav
  class={tw(`fixed bottom-5 right-2 
  md:right-[unset] bg-background/10 z-50 
  rounded-full gap-4 shadow-lg p-2 
  backdrop-blur-md flex flex-col-reverse
  items-end md:flex-row md:items-center 
  justify-center ring-[1px]ring-text/30`)}
>
  {#each ROUTES as { name, path } (path)}
    <a
      class={tw(`hover:bg-accent/50 active:bg-accent/50 relative 
      rounded-full px-1.5 md:px-3 py-1.5 text-sm font-medium
      transition focus-visible:outline-2 outline-sky-400 
      [-webkit-tap-highlight-color:transparent]`)}
      href={path}
      data-sveltekit-preload-code
    >
      {#if $page.url.pathname === path}
        <span
          in:receive={{ key: BUBBLE }}
          out:send={{ key: BUBBLE }}
          class="absolute inset-0 z-[60] bg-accent rounded-full"
        />
      {/if}
      <span
        class="relative z-[60] flex gap-2 text-text data-[active=true]:text-text"
        data-active={$page.url.pathname === path}
      >
        <svg
          class="w-6 h-6 fill-text"
          viewBox="0 0 800 800"
          fill="none"
          xmlns="http://www.w3.org/2000/svg"
        >
          {#if path === "/app"}
            <g clip-path="url(#clip0_1716_10)">
              <path
                d="M126.562 429.234C141.188 567.188 258.219 675 400 675C438.49 675.043 476.556 666.955 511.703 651.266C448.734 625.438 380.375 591.625 312.063 552.266C245.313 513.844 181 471.094 126.562 429.234Z"
                fill="white"
              />
              <path
                d="M769.876 530.484C756.595 512.813 738.626 493.297 716.751 472.672C712.578 490.846 706.827 508.622 699.564 525.797C744.439 571.891 751.439 596.641 749.83 601.5C746.705 604.984 723.189 612.266 658.97 595.984C649.772 593.651 639.71 590.807 628.783 587.453C621.741 585.287 614.559 582.948 607.236 580.438C618.739 567.244 628.962 552.988 637.767 537.859C638.033 537.406 638.314 536.953 638.58 536.484C662.438 494.954 674.996 447.896 675.001 400C675.008 390.084 674.486 380.174 673.439 370.313C658.486 232.547 541.564 125 400.001 125C339.936 124.966 281.524 144.669 233.751 181.078C204.796 203.116 180.464 230.64 162.142 262.078C161.892 262.531 161.611 262.984 161.345 263.438C152.637 278.608 145.401 294.576 139.736 311.125C133.913 306.052 128.293 301.016 122.876 296.016C114.454 288.203 106.986 280.969 100.345 274.141C54.142 226.859 48.642 202.875 50.0951 198.438C53.4701 194.641 78.3764 188.219 140.923 203.984C152.219 189.108 164.764 175.225 178.423 162.484C148.954 153.719 122.501 147.875 100.22 145.297C52.2045 139.797 20.7826 149.25 6.79824 173.438C1.73574 182.156 -3.12363 197.016 2.54824 218.125C10.9389 249.469 40.8451 287.5 83.1732 327.344C96.6576 340.047 111.392 352.922 127.111 365.844C138.548 375.219 150.548 384.688 162.892 394.094C171.132 400.344 179.543 406.594 188.126 412.844C196.71 419.094 205.408 425.229 214.22 431.25C253.923 458.766 295.876 485.188 337.017 508.891C351.954 517.495 366.871 525.828 381.767 533.891C396.663 541.953 411.439 549.667 426.095 557.031C460.314 574.219 493.83 589.719 525.876 603.016C539.616 608.724 553.059 614.016 566.205 618.891C584.783 625.797 602.72 631.875 619.814 637L621.533 637.516C661.736 649.484 695.626 655.781 722.283 656.266H725.001C758.814 656.266 781.72 646.297 793.095 626.578C807.298 602.172 799.47 569.828 769.876 530.484Z"
                fill="white"
              />
            </g>
            <defs>
              <clipPath id="clip0_1716_10">
                <rect width="800" height="800" fill="white" />
              </clipPath>
            </defs>
          {:else if path === "/app/feed"}
            <path
              d="M225 325H325V475H225V325ZM725 175V675C725 679.262 723.911 683.453 721.836 687.175C719.761 690.897 716.769 694.028 713.143 696.268C709.518 698.508 705.38 699.785 701.123 699.976C696.865 700.167 692.63 699.267 688.818 697.36L600 652.951L511.182 697.36C507.71 699.096 503.882 700 500 700C496.118 700 492.29 699.096 488.818 697.36L400 652.951L311.182 697.36C307.71 699.097 303.882 700.002 300 700.002C296.118 700.002 292.29 699.097 288.818 697.36L200 652.951L111.182 697.36C107.37 699.267 103.135 700.167 98.8771 699.976C94.6197 699.785 90.4818 698.508 86.8565 696.268C83.2312 694.028 80.2389 690.897 78.1638 687.175C76.0886 683.453 74.9995 679.262 75 675V175C75.0152 161.744 80.2879 149.035 89.6614 139.661C99.0349 130.288 111.744 125.015 125 125H675C688.256 125.015 700.965 130.288 710.339 139.661C719.712 149.035 724.985 161.744 725 175ZM375 300C375 293.37 372.366 287.011 367.677 282.323C362.989 277.634 356.63 275 350 275H200C193.37 275 187.011 277.634 182.323 282.323C177.634 287.011 175 293.37 175 300V500C175 506.63 177.634 512.989 182.323 517.677C187.011 522.366 193.37 525 200 525H350C356.63 525 362.989 522.366 367.677 517.677C372.366 512.989 375 506.63 375 500V300ZM625 450C625 443.37 622.366 437.011 617.677 432.323C612.989 427.634 606.63 425 600 425H450C443.37 425 437.011 427.634 432.322 432.322C427.634 437.011 425 443.37 425 450C425 456.63 427.634 462.989 432.322 467.678C437.011 472.366 443.37 475 450 475H600C606.63 475 612.989 472.366 617.677 467.677C622.366 462.989 625 456.63 625 450ZM625 350C625 343.37 622.366 337.011 617.677 332.323C612.989 327.634 606.63 325 600 325H450C443.37 325 437.011 327.634 432.322 332.322C427.634 337.011 425 343.37 425 350C425 356.63 427.634 362.989 432.322 367.678C437.011 372.366 443.37 375 450 375H600C606.63 375 612.989 372.366 617.677 367.677C622.366 362.989 625 356.63 625 350Z"
              fill="white"
            />
          {:else}
            <path
              d="M399.997 66.6641C215.997 66.6641 66.6641 215.997 66.6641 399.997C66.6641 583.997 215.997 733.331 399.997 733.331C583.997 733.331 733.331 583.997 733.331 399.997C733.331 215.997 583.997 66.6641 399.997 66.6641ZM399.997 166.664C455.331 166.664 499.997 211.331 499.997 266.664C499.997 321.997 455.331 366.664 399.997 366.664C344.664 366.664 299.997 321.997 299.997 266.664C299.997 211.331 344.664 166.664 399.997 166.664ZM399.997 639.997C316.664 639.997 242.997 597.331 199.997 532.664C200.997 466.331 333.331 429.997 399.997 429.997C466.331 429.997 598.997 466.331 599.997 532.664C556.997 597.331 483.331 639.997 399.997 639.997Z"
              fill="white"
            />
          {/if}
        </svg>
        <span class="text-base hidden md:block">
          {name}
        </span>
      </span>
    </a>
  {/each}
</nav>
